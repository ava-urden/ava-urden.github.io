<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Web Analytics Demo</title>

  <!-- Valfri CSS -->
  <link href="https://jesperastrom.github.io/resources/css/index.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">

  <!-- Init dataLayer FÖRE GTM -->
  <script>window.dataLayer = window.dataLayer || [];</script>

  <!-- Google Tag Manager (HEAD) – DIN CONTAINER -->
  <script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5JMB8KM3');
  </script>
  <!-- End GTM (HEAD) -->
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5JMB8KM3"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End GTM (noscript) -->

  <header>
    <ul class="breadcrumb">
      <li><a href="#" id="bc-home">Home</a></li>
    </ul>
  </header>

  <main>
    <section id="top" class="content">
      <h1>Demo shop</h1>
    </section>

    <section class="content">
      <p>Den här sidan visar hur dataLayer kan användas för webbanalys.</p>
      <p>Öppna konsolen och skriv <code>dataLayer</code> när du klickar runt.</p>
    </section>

    <nav>
      <ul>
        <li><a href="#" id="home-link">Home</a></li>
        <li><a href="#products" id="products-link">Products</a></li>
        <li><a href="#" id="about-link">About</a></li>
        <li><a href="#" id="contact-link">Contact</a></li>
      </ul>
    </nav>

    <section id="hero" class="content">
      <button id="cta-button">Click Me!</button>
    </section>

    <section id="products" class="content">
      <h2>Products</h2>
      <div class="product-grid">
        <div class="product" data-product-id="123" data-product-name="Product A" data-product-price="199.00">
          <h3>Product A</h3>
          <p>199 kr</p>
          <button class="add-to-cart">Add to Cart</button>
        </div>
        <div class="product" data-product-id="456" data-product-name="Product B" data-product-price="299.00">
          <h3>Product B</h3>
          <p>299 kr</p>
          <button class="add-to-cart">Add to Cart</button>
        </div>
        <div class="product" data-product-id="789" data-product-name="Product C" data-product-price="399.00">
          <h3>Product C</h3>
          <p>399 kr</p>
          <button class="add-to-cart">Add to Cart</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Web Analytics Demo</p>
  </footer>

  <!-- Inline analytics: binder lyssnare & pushar till dataLayer -->
  <script>
  (function () {
    function dlPush(obj){
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push(obj);
      console.log('[dataLayer.push]', obj);
    }

    // Grundmetadata (bra för segmentering)
    dlPush({
      event: 'page_meta',
      page_type: 'demo_shop',
      page_language: document.documentElement.lang || 'sv',
      user_status: 'logged_out'
    });

    // NAV-klick
    function wireNav(){
      document.querySelectorAll('nav a').forEach(a=>{
        a.addEventListener('click', ()=>{
          dlPush({
            event: 'nav_click',
            link_text: a.textContent.trim(),
            link_id: a.id || null,
            link_url: a.getAttribute('href'),
            page_section: 'nav'
          });
        });
      });
      const bc = document.getElementById('bc-home');
      if(bc){
        bc.addEventListener('click', ()=>{
          dlPush({
            event: 'nav_click',
            link_text: 'Breadcrumb Home',
            link_id: 'bc-home',
            link_url: '#',
            page_section: 'breadcrumb'
          });
        });
      }
    }

    // CTA-klick
    function wireCTA(){
      const btn = document.getElementById('cta-button');
      if(!btn) return;
      btn.addEventListener('click', ()=>{
        dlPush({
          event: 'cta_click',
          button_id: 'cta-button',
          button_text: btn.textContent.trim(),
          page_section: 'hero',
          placement: 'home_hero'
        });
      });
    }

    // Add to cart (GA4 e-comm format)
    function wireATC(){
      document.querySelectorAll('.product .add-to-cart').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const card = btn.closest('.product');
          if(!card) return;
          const id = card.dataset.productId;
          const name = card.dataset.productName;
          const price = parseFloat(card.dataset.productPrice || '0');
          dlPush({
            event: 'add_to_cart',
            currency: 'SEK',
            value: price,
            items: [{
              item_id: id,
              item_name: name,
              price: price,
              quantity: 1,
              item_category: 'Demo'
            }]
          });
        });
      });
    }

    // View item list (när produktsektionen är ~50% synlig)
    function wireViewItemList(){
      const section = document.getElementById('products');
      if(!section || typeof IntersectionObserver === 'undefined') return;
      let fired = false;
      const toItems = () => Array.from(section.querySelectorAll('.product')).map(p=>({
        item_id: p.dataset.productId,
        item_name: p.dataset.productName,
        price: parseFloat(p.dataset.productPrice || '0'),
        item_category: 'Demo'
      }));
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting && entry.intersectionRatio >= 0.5 && !fired){
            fired = true;
            dlPush({
              event: 'view_item_list',
              item_list_id: 'home_products',
              item_list_name: 'Homepage Products',
              items: toItems()
            });
            io.disconnect();
          }
        });
      }, { threshold: [0.5] });
      io.observe(section);
    }

    function init(){
      wireNav();
      wireCTA();
      wireATC();
      wireViewItemList();
    }

    if(document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', init);
    }else{
      init();
    }
  })();
  </script>
</body>
</html>
